<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Agents - Admin</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .agent-table {
            width: 100%; border-collapse: collapse; margin-top: 30px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        .agent-table th, .agent-table td {
            padding: 15px; text-align: left; border-bottom: 1px solid #333; background-color: #1e1e1e;
        }
        .agent-table th {
            background-color: #2a2a2a; color: #ffc107; font-size: 1rem; font-weight: 700; text-transform: uppercase;
        }
        .agent-info { font-weight: 700; color: #00aaff; }
        .cash-earned { color: #00ff88; font-weight: 700; }
        .star-earned { color: #ffc107; font-weight: 700; }
        .btn-remove-agent { background-color: #ff4d4d; color: white; padding: 5px 10px; border-radius: 4px; text-decoration: none; font-size: 0.9rem; }
    
        /* Add Agent Form Style */
        .add-agent-form {
            background-color: #1e1e1e;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #333;
            margin-bottom: 30px;
        }
        .add-agent-form h3 {
            margin-top: 0; color: #00aaff;
        }
        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 15px;
            align-items: flex-end;
        }
        .form-row label { display: block; margin-bottom: 5px; color: #b0b0b0; }
        .form-row select, .form-row button {
            padding: 12px;
            background-color: #121212;
            border: 1px solid #444;
            color: white;
            border-radius: 5px;
            font-size: 1rem;
        }
        .form-row button {
            background-color: #00ff88; color: #121212; font-weight: 700; cursor: pointer;
        }
    </style>
</head>
<body>
    
    <nav>
        <div class="container nav-container">
            <div class="nav-left">
                <a href="/" class="logo">ADMIN<span>PANEL</span></a>
                <div class="menu-links">
                    <a href="/">View Site</a>
                    <a href="/admin">Dashboard</a>
                </div>
            </div>
            <div class="user-actions">
                 {% if session['username'] %}
                    <span style="color: white; margin-right: 10px;">Welcome, {{ session['username'] }}!</span>
                    <a href="/logout" class="login-btn" style="background-color: #ff4d4d;">Logout</a>
                 {% endif %}
            </div>
        </div>
    </nav>

    <section class="dashboard">
        <div class="container">
            
            <a href="/admin" class="back-button">
                &larr; Back to Admin Dashboard
            </a>

            <h2 class="section-title">üíº Manage Agents</h2>

            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                <div style="max-width: 100%; margin: 0 auto 20px auto;">
                {% for category, message in messages %}
                  <div class="flash-message {{ category }}">{{ message }}</div>
                {% endfor %}
                </div>
              {% endif %}
            {% endwith %}

            <form class="add-agent-form" method="POST" action="{{ url_for('admin_add_agent') }}">
                <h3>‚ûï Add New Agent</h3>
                <div class="form-row">
                    <div>
                        <label for="user_id">User ko Chunein</label>
                        <select name="user_id" id="user_id" required>
                            <option value="">-- User Select Karein --</option>
                            {% for user in potential_agents %}
                                <option value="{{ user.id }}">@{{ user.username }} (ID: {{ user.id }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="commission_type">Commission Type</label>
                        <select name="commission_type" id="commission_type">
                            <option value="CASH">Cash (‚Çπ)</option>
                            <option value="STARS">Stars (‚≠ê)</option>
                        </select>
                    </div>
                    <button type="submit">Add Agent</button>
                </div>
            </form>
            
            <div style="text-align: right; margin-bottom: 20px; margin-top: -10px;">
                <a href="{{ url_for('admin_commission_settings') }}" class="action-btn btn-approve" style="background-color: #00aaff;">
                    üí∞ Set Commission Rates
                </a>
            </div>

            {% if agents %}
            <table class="agent-table">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Type</th>
                        <th>Cash Earned</th>
                        <th>Stars Earned</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for agent in agents %}
                    <tr>
                        <td class="agent-info">@{{ agent.username }}</td>
                        <td>{{ agent.commission_type }}</td>
                        <td class="cash-earned">‚Çπ{{ "%.2f"|format(agent.total_cash_earned) }}</td>
                        <td class="star-earned">{{ agent.total_stars_earned }} ‚≠ê</td>
                        <td>
                            <a href="{{ url_for('admin_delete_agent', user_id=agent.user_id) }}" class="btn-remove-agent" onclick="return confirm('Confirm remove agent @{{ agent.username }}?');">
                                ‚ùå Remove
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="no-orders-message">
                <h3>Koi Agents nahi mile‡•§</h3>
                <p style="color: #888;">Upar diye gaye form se naye agents add karein.</p>
            </div>
            {% endif %}

        </div>
    </section>

    <footer>
        <div class="container">
            <p>¬© 2025 ADI SELLX Admin Panel</p>
        </div>
    </footer>

</body>
</html>